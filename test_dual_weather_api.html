<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒAPIå¤©æ°”ç³»ç»Ÿæµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.12/css/weather-icons.min.css" rel="stylesheet">
    <style>
        .weather-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 24px;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .weather-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .weather-main {
            position: relative;
            z-index: 2;
        }

        .weather-temp {
            display: flex;
            align-items: baseline;
            margin-bottom: 12px;
        }

        .temp-value {
            font-size: 3rem;
            font-weight: 300;
            line-height: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .temp-unit {
            font-size: 1.4rem;
            font-weight: 300;
            margin-left: 6px;
            opacity: 0.9;
        }

        .weather-desc {
            font-size: 1.2rem;
            margin-bottom: 6px;
            opacity: 0.95;
            font-weight: 400;
        }

        .weather-location {
            opacity: 0.85;
            font-size: 0.95rem;
            font-weight: 300;
        }

        .weather-icon {
            width: 90px;
            height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .weather-details {
            position: relative;
            z-index: 2;
            background: rgba(255,255,255,0.12);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .weather-detail-item {
            text-align: center;
        }

        .weather-detail-item i {
            font-size: 1.4rem;
            margin-bottom: 8px;
            opacity: 0.9;
        }

        .weather-detail-item .small {
            font-size: 0.85rem;
            opacity: 0.85;
            margin-bottom: 4px;
            font-weight: 300;
        }

        .weather-detail-item .fw-bold {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .error {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .weather-card.sunny {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .weather-card.cloudy {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .weather-card.rainy {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .api-source-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 3;
        }

        .api-source-badge .badge {
            background: rgba(255,255,255,0.2) !important;
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
        }

        .amap-source {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .openweather-source {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <h2 class="text-center mb-4">ğŸŒ¤ï¸ åŒAPIå¤©æ°”ç³»ç»Ÿæµ‹è¯•</h2>
                
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title">ç³»ç»Ÿè¯´æ˜</h5>
                        <p class="card-text">
                            æœ¬ç³»ç»Ÿé‡‡ç”¨<strong>åŒAPIå¤‡ç”¨æœºåˆ¶</strong>ï¼š
                        </p>
                        <ul>
                            <li><strong>ä¸»è¦API</strong>ï¼šé«˜å¾·å¼€æ”¾å¹³å° (16322187213696b230c7340477eaba34)</li>
                            <li><strong>å¤‡ç”¨API</strong>ï¼šOpenWeather (8091ce90ee692da18471b3961900b431)</li>
                            <li><strong>åˆ‡æ¢é€»è¾‘</strong>ï¼šé«˜å¾·APIå¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°OpenWeather API</li>
                            <li><strong>æ•°æ®æ¥æºæ ‡è¯†</strong>ï¼šæ¯ä¸ªå¤©æ°”å¡ç‰‡ä¼šæ˜¾ç¤ºæ•°æ®æ¥æº</li>
                        </ul>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <h5>é«˜å¾·APIæµ‹è¯•</h5>
                        <div id="amap-weather-container">
                            <div class="weather-card loading">
                                <div class="loading">
                                    <div class="spinner-border text-white" role="status">
                                        <span class="visually-hidden">åŠ è½½ä¸­...</span>
                                    </div>
                                    <p class="mt-3 mb-0">æ­£åœ¨æµ‹è¯•é«˜å¾·API...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-4">
                        <h5>OpenWeather APIæµ‹è¯•</h5>
                        <div id="openweather-weather-container">
                            <div class="weather-card loading">
                                <div class="loading">
                                    <div class="spinner-border text-white" role="status">
                                        <span class="visually-hidden">åŠ è½½ä¸­...</span>
                                    </div>
                                    <p class="mt-3 mb-0">æ­£åœ¨æµ‹è¯•OpenWeather API...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-4">
                        <h5>è‡ªåŠ¨å¤‡ç”¨æµ‹è¯•</h5>
                        <div id="fallback-weather-container">
                            <div class="weather-card loading">
                                <div class="loading">
                                    <div class="spinner-border text-white" role="status">
                                        <span class="visually-hidden">åŠ è½½ä¸­...</span>
                                    </div>
                                    <p class="mt-3 mb-0">æ­£åœ¨æµ‹è¯•å¤‡ç”¨æœºåˆ¶...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center">
                    <button class="btn btn-primary me-2" onclick="testAmapApi()">
                        <i class="fas fa-sync-alt me-2"></i>æµ‹è¯•é«˜å¾·API
                    </button>
                    <button class="btn btn-success me-2" onclick="testOpenWeatherApi()">
                        <i class="fas fa-cloud me-2"></i>æµ‹è¯•OpenWeather API
                    </button>
                    <button class="btn btn-warning" onclick="testFallbackMechanism()">
                        <i class="fas fa-shield-alt me-2"></i>æµ‹è¯•å¤‡ç”¨æœºåˆ¶
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const AMAP_API_KEY = '16322187213696b230c7340477eaba34';
        const OPENWEATHER_API_KEY = '8091ce90ee692da18471b3961900b431';
        const CITY_CODE = '500000'; // é‡åº†å¸‚
        
        // å¤©æ°”å›¾æ ‡æ˜ å°„
        const weatherIconMap = {
            'æ™´': 'wi-day-sunny',
            'å°‘äº‘': 'wi-day-cloudy',
            'æ™´é—´å¤šäº‘': 'wi-day-cloudy',
            'å¤šäº‘': 'wi-cloudy',
            'é˜´': 'wi-cloudy',
            'é˜µé›¨': 'wi-day-showers',
            'é›·é˜µé›¨': 'wi-day-thunderstorm',
            'å°é›¨': 'wi-rain',
            'ä¸­é›¨': 'wi-rain',
            'å¤§é›¨': 'wi-rain',
            'æš´é›¨': 'wi-rain',
            'é›ª': 'wi-snow',
            'é›¾': 'wi-fog',
            'æœªçŸ¥': 'wi-na'
        };
        
        const openweatherIconMap = {
            '01d': 'wi-day-sunny',
            '01n': 'wi-night-clear',
            '02d': 'wi-day-cloudy',
            '02n': 'wi-night-alt-cloudy',
            '03d': 'wi-cloudy',
            '03n': 'wi-cloudy',
            '04d': 'wi-cloudy',
            '04n': 'wi-cloudy',
            '09d': 'wi-showers',
            '09n': 'wi-night-alt-showers',
            '10d': 'wi-day-rain',
            '10n': 'wi-night-alt-rain',
            '11d': 'wi-thunderstorm',
            '11n': 'wi-thunderstorm',
            '13d': 'wi-snow',
            '13n': 'wi-snow',
            '50d': 'wi-fog',
            '50n': 'wi-fog'
        };
        
        function getWeatherIcon(weather, isAmap = true) {
            if (isAmap) {
                return weatherIconMap[weather] || 'wi-na';
            } else {
                return openweatherIconMap[weather] || 'wi-na';
            }
        }
        
        function getWeatherType(weather) {
            if (weather.includes('æ™´') || weather.includes('sunny')) return 'sunny';
            if (weather.includes('é›¨') || weather.includes('rain')) return 'rainy';
            if (weather.includes('äº‘') || weather.includes('é˜´') || weather.includes('cloud')) return 'cloudy';
            return 'cloudy';
        }
        
        function renderWeatherCard(container, weatherData, apiSource) {
            const weatherType = getWeatherType(weatherData.description || weatherData.weather || '');
            const sourceClass = apiSource === 'amap' ? 'amap-source' : 'openweather-source';
            const sourceName = apiSource === 'amap' ? 'é«˜å¾·å¼€æ”¾å¹³å°' : 'OpenWeather';
            
            container.innerHTML = `
                <div class="weather-card ${weatherType} ${sourceClass}">
                    <div class="api-source-badge">
                        <span class="badge">
                            <i class="fas fa-${apiSource === 'amap' ? 'map' : 'globe'} me-1"></i>${sourceName}
                        </span>
                    </div>
                    <div class="weather-main d-flex align-items-start justify-content-between">
                        <div class="weather-info">
                            <div class="weather-temp">
                                <span class="temp-value">${weatherData.temperature}</span>
                                <span class="temp-unit">Â°C</span>
                            </div>
                            <div class="weather-desc">${weatherData.description || weatherData.weather}</div>
                            <div class="weather-location">
                                <i class="fas fa-map-marker-alt me-1"></i>${weatherData.location || weatherData.city || 'é‡åº†'}
                            </div>
                        </div>
                        <div class="weather-icon">
                            <i class="wi ${weatherData.icon}"></i>
                        </div>
                    </div>
                    <div class="weather-details mt-4">
                        <div class="row text-center">
                            <div class="col-6">
                                <div class="weather-detail-item">
                                    <i class="wi wi-thermometer"></i>
                                    <div class="small">ä½“æ„Ÿæ¸©åº¦</div>
                                    <div class="fw-bold">${weatherData.feels_like || weatherData.temperature}Â°C</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="weather-detail-item">
                                    <i class="wi wi-humidity"></i>
                                    <div class="small">æ¹¿åº¦</div>
                                    <div class="fw-bold">${weatherData.humidity}%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <small class="opacity-75">
                            <i class="fas fa-clock me-1"></i>æ›´æ–°æ—¶é—´: ${new Date().toLocaleString('zh-CN')}
                        </small>
                    </div>
                </div>
            `;
        }
        
        function renderErrorCard(container, errorMessage, apiSource) {
            const sourceName = apiSource === 'amap' ? 'é«˜å¾·API' : 'OpenWeather API';
            container.innerHTML = `
                <div class="weather-card error">
                    <div class="text-center">
                        <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                        <h5>${sourceName}è·å–å¤±è´¥</h5>
                        <p class="mb-0">é”™è¯¯ä¿¡æ¯: ${errorMessage}</p>
                    </div>
                </div>
            `;
        }
        
        async function testAmapApi() {
            const container = document.getElementById('amap-weather-container');
            
            container.innerHTML = `
                <div class="weather-card loading">
                    <div class="loading">
                        <div class="spinner-border text-white" role="status">
                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                        </div>
                        <p class="mt-3 mb-0">æ­£åœ¨æµ‹è¯•é«˜å¾·API...</p>
                    </div>
                </div>
            `;
            
            try {
                const url = `https://restapi.amap.com/v3/weather/weatherInfo?key=${AMAP_API_KEY}&city=${CITY_CODE}&extensions=base&output=json`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.status !== '1') {
                    throw new Error(`APIé”™è¯¯: ${data.info || 'æœªçŸ¥é”™è¯¯'}`);
                }
                
                const lives = data.lives;
                if (!lives || lives.length === 0) {
                    throw new Error('æœªè·å–åˆ°å®å†µå¤©æ°”æ•°æ®');
                }
                
                const weather = lives[0];
                const weatherData = {
                    temperature: parseInt(weather.temperature),
                    feels_like: parseInt(weather.temperature),
                    humidity: parseInt(weather.humidity),
                    description: weather.weather,
                    icon: getWeatherIcon(weather.weather, true),
                    location: weather.city
                };
                
                renderWeatherCard(container, weatherData, 'amap');
                
            } catch (error) {
                console.error('é«˜å¾·APIæµ‹è¯•å¤±è´¥:', error);
                renderErrorCard(container, error.message, 'amap');
            }
        }
        
        async function testOpenWeatherApi() {
            const container = document.getElementById('openweather-weather-container');
            
            container.innerHTML = `
                <div class="weather-card loading">
                    <div class="loading">
                        <div class="spinner-border text-white" role="status">
                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                        </div>
                        <p class="mt-3 mb-0">æ­£åœ¨æµ‹è¯•OpenWeather API...</p>
                    </div>
                </div>
            `;
            
            try {
                const url = `https://api.openweathermap.org/data/2.5/weather?q=Chongqing,CN&appid=${OPENWEATHER_API_KEY}&units=metric&lang=zh_cn`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                }
                
                const data = await response.json();
                
                const weatherData = {
                    temperature: Math.round(data.main.temp),
                    feels_like: Math.round(data.main.feels_like),
                    humidity: data.main.humidity,
                    description: data.weather[0].description,
                    icon: getWeatherIcon(data.weather[0].icon, false),
                    location: 'é‡åº†'
                };
                
                renderWeatherCard(container, weatherData, 'openweather');
                
            } catch (error) {
                console.error('OpenWeather APIæµ‹è¯•å¤±è´¥:', error);
                renderErrorCard(container, error.message, 'openweather');
            }
        }
        
        async function testFallbackMechanism() {
            const container = document.getElementById('fallback-weather-container');
            
            container.innerHTML = `
                <div class="weather-card loading">
                    <div class="loading">
                        <div class="spinner-border text-white" role="status">
                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                        </div>
                        <p class="mt-3 mb-0">æ­£åœ¨æµ‹è¯•å¤‡ç”¨æœºåˆ¶...</p>
                    </div>
                </div>
            `;
            
            // é¦–å…ˆå°è¯•é«˜å¾·API
            try {
                const amapUrl = `https://restapi.amap.com/v3/weather/weatherInfo?key=${AMAP_API_KEY}&city=${CITY_CODE}&extensions=base&output=json`;
                const amapResponse = await fetch(amapUrl);
                
                if (amapResponse.ok) {
                    const amapData = await amapResponse.json();
                    if (amapData.status === '1' && amapData.lives && amapData.lives.length > 0) {
                        const weather = amapData.lives[0];
                        const weatherData = {
                            temperature: parseInt(weather.temperature),
                            feels_like: parseInt(weather.temperature),
                            humidity: parseInt(weather.humidity),
                            description: weather.weather,
                            icon: getWeatherIcon(weather.weather, true),
                            location: weather.city
                        };
                        
                        renderWeatherCard(container, weatherData, 'amap');
                        
                        // æ˜¾ç¤ºæˆåŠŸä½¿ç”¨ä¸»è¦APIçš„æ¶ˆæ¯
                        setTimeout(() => {
                            const badge = container.querySelector('.api-source-badge .badge');
                            if (badge) {
                                badge.innerHTML = '<i class="fas fa-check me-1"></i>ä¸»è¦APIæˆåŠŸ';
                            }
                        }, 1000);
                        
                        return;
                    }
                }
                
                throw new Error('é«˜å¾·APIå¤±è´¥ï¼Œåˆ‡æ¢åˆ°å¤‡ç”¨API');
                
            } catch (error) {
                console.log('é«˜å¾·APIå¤±è´¥ï¼Œå°è¯•OpenWeather API:', error.message);
                
                // é«˜å¾·APIå¤±è´¥ï¼Œå°è¯•OpenWeather API
                try {
                    const openweatherUrl = `https://api.openweathermap.org/data/2.5/weather?q=Chongqing,CN&appid=${OPENWEATHER_API_KEY}&units=metric&lang=zh_cn`;
                    const openweatherResponse = await fetch(openweatherUrl);
                    
                    if (!openweatherResponse.ok) {
                        throw new Error(`OpenWeather HTTPé”™è¯¯: ${openweatherResponse.status}`);
                    }
                    
                    const openweatherData = await openweatherResponse.json();
                    
                    const weatherData = {
                        temperature: Math.round(openweatherData.main.temp),
                        feels_like: Math.round(openweatherData.main.feels_like),
                        humidity: openweatherData.main.humidity,
                        description: openweatherData.weather[0].description,
                        icon: getWeatherIcon(openweatherData.weather[0].icon, false),
                        location: 'é‡åº†'
                    };
                    
                    renderWeatherCard(container, weatherData, 'openweather');
                    
                    // æ˜¾ç¤ºå¤‡ç”¨APIæˆåŠŸçš„æ¶ˆæ¯
                    setTimeout(() => {
                        const badge = container.querySelector('.api-source-badge .badge');
                        if (badge) {
                            badge.innerHTML = '<i class="fas fa-shield-alt me-1"></i>å¤‡ç”¨APIæˆåŠŸ';
                        }
                    }, 1000);
                    
                } catch (fallbackError) {
                    console.error('å¤‡ç”¨APIä¹Ÿå¤±è´¥:', fallbackError);
                    renderErrorCard(container, 'æ‰€æœ‰APIéƒ½å¤±è´¥äº†', 'fallback');
                }
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•æ‰€æœ‰API
        document.addEventListener('DOMContentLoaded', function() {
            testAmapApi();
            testOpenWeatherApi();
            testFallbackMechanism();
        });
    </script>
</body>
</html>
