{% extends 'base.html' %}

{% block title %}个人资料 - 重庆师范大学师能素质协会{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-md-3">
            {% include 'student/sidebar.html' %}
        </div>
        <div class="col-md-9">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">个人资料</h5>
                    <div>
                        <a href="{{ url_for('student.edit_profile') }}" class="btn btn-light btn-sm">
                            <i class="fas fa-edit"></i> 编辑资料
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <th style="width: 30%">姓名</th>
                                    <td>{{ student_info.real_name }}</td>
                                </tr>
                                <tr>
                                    <th>学号</th>
                                    <td>{{ student_info.student_id }}</td>
                                </tr>
                                <tr>
                                    <th>年级</th>
                                    <td>{{ student_info.grade }}</td>
                                </tr>
                                <tr>
                                    <th>专业</th>
                                    <td>{{ student_info.major }}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <th style="width: 30%">学院</th>
                                    <td>{{ student_info.college }}</td>
                                </tr>
                                <tr>
                                    <th>手机号</th>
                                    <td>{{ student_info.phone }}</td>
                                </tr>
                                <tr>
                                    <th>QQ</th>
                                    <td>{{ student_info.qq }}</td>
                                </tr>
                                <tr>
                                    <th>积分</th>
                                    <td>
                                        <span class="badge bg-success">{{ student_info.points }}</span>
                                        <a href="{{ url_for('student.points') }}" class="ms-2 small">查看详情</a>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 兴趣标签部分 -->
                    <div class="mt-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">我的兴趣标签</h6>
                            <a href="{{ url_for('select_tags.select_tags') }}" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-tags"></i> 修改标签
                            </a>
                        </div>
                        
                        <div class="d-flex flex-wrap gap-2">
                            {% if student_tags %}
                                {% for tag in student_tags %}
                                    <span class="badge bg-info text-dark">{{ tag.name }}</span>
                                {% endfor %}
                            {% else %}
                                <p class="text-muted small">您还没有选择兴趣标签，点击"修改标签"添加您的兴趣爱好，以便我们为您推荐更合适的活动。</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('auth.change_password') }}" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-key"></i> 修改密码
                        </a>
                        <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                            <i class="fas fa-user-times"></i> 注销账号
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 注销账号确认模态框 -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteAccountModalLabel">确认注销账号</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i> 警告：此操作将永久删除您的账号和所有相关数据，且无法恢复！
                </div>
                <p>请输入您的密码以确认注销账号：</p>
                <form id="deleteAccountForm" method="post" action="{{ url_for('student.delete_account') }}">
                    <div class="mb-3">
                        <label for="password" class="form-label">密码</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="submit" form="deleteAccountForm" class="btn btn-danger">确认注销</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    .avatar-circle {
        width: 100px;
        height: 100px;
        background-color: #007bff;
        border-radius: 50%;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .avatar-text {
        color: white;
        font-size: 42px;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 使用变量保存模态框实例
        let deactivateModal = null;
        
        // 点击按钮时初始化并显示模态框
        document.getElementById('showDeactivateModal').addEventListener('click', function() {
            // 如果模态框实例已存在，先销毁它
            if (deactivateModal) {
                deactivateModal.dispose();
                deactivateModal = null;
            }
            
            // 创建新的模态框实例
            const modalElement = document.getElementById('deactivateAccountModal');
            deactivateModal = new bootstrap.Modal(modalElement, {
                backdrop: 'static',
                keyboard: false
            });
            
            // 显示模态框
            deactivateModal.show();
            
            // 清空输入框
            document.getElementById('confirmUsername').value = '';
            
            // 模态框隐藏后的清理
            modalElement.addEventListener('hidden.bs.modal', function() {
                // 延迟销毁模态框实例，避免内存泄漏
                setTimeout(function() {
                    if (deactivateModal) {
                        deactivateModal.dispose();
                        deactivateModal = null;
                    }
                }, 100);
            }, { once: true });
        });
    });
</script>
{% endblock %}
