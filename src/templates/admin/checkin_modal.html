{% extends 'base.html' %}

{% block title %}签到二维码 - {{ activity.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">{{ activity.title }} - 签到二维码</h5>
                </div>
                <div class="card-body text-center">
                    <div class="mb-4">
                        <p class="lead">让学生扫描下方二维码完成签到</p>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>该二维码有效期为24小时，超时后需重新生成
                        </div>
                        
                        <!-- 签到状态切换按钮 -->
                        <div class="mb-3">
                            <div class="alert {% if activity.checkin_enabled %}alert-success{% else %}alert-warning{% endif %}">
                                <strong>签到状态：</strong>
                                {% if activity.checkin_enabled %}
                                    <span class="text-success">已开启</span> (忽略活动时间限制)
                                {% else %}
                                    <span class="text-warning">已关闭</span> (仅在活动时间范围内可签到)
                                {% endif %}
                            </div>
                            <form action="{{ url_for('admin.toggle_checkin', id=activity.id) }}" method="post" class="d-inline">
                                <button type="submit" class="btn {% if activity.checkin_enabled %}btn-warning{% else %}btn-success{% endif %} mb-2">
                                    <i class="fas {% if activity.checkin_enabled %}fa-toggle-off{% else %}fa-toggle-on{% endif %} me-1"></i>
                                    {% if activity.checkin_enabled %}停止签到{% else %}开始签到{% endif %}
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <div class="qrcode-container border p-3 mb-4 d-inline-block">
                        <img src="{{ url_for('admin.generate_checkin_qrcode', id=activity.id) }}" alt="签到二维码" class="img-fluid" style="max-width: 100%; width: 300px;">
                    </div>
                    
                    <div class="mt-3">
                        <p class="mb-2"><strong>活动时间：</strong> {{ activity.start_time.strftime('%Y-%m-%d %H:%M') }} 至 {{ activity.end_time.strftime('%Y-%m-%d %H:%M') }}</p>
                        <p><strong>活动地点：</strong> {{ activity.location }}</p>
                    </div>
                    
                    <div class="mt-4 d-flex flex-wrap justify-content-center">
                        <a href="#" class="btn btn-primary m-1" onclick="window.print();">
                            <i class="fas fa-print me-1"></i>打印二维码
                        </a>
                        <a href="{{ url_for('admin.generate_checkin_qrcode', id=activity.id) }}" class="btn btn-success m-1" download="签到二维码-{{ activity.title }}.png">
                            <i class="fas fa-download me-1"></i>下载二维码
                        </a>
                        <a href="{{ url_for('admin.activity_view', id=activity.id) }}" class="btn btn-secondary m-1">
                            <i class="fas fa-arrow-left me-1"></i>返回活动详情
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
{{ super() }}
<style>
    @media print {
        body * {
            visibility: hidden;
        }
        .card, .card * {
            visibility: visible;
        }
        .card {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }
        .btn {
            display: none !important;
        }
    }
    
    .qrcode-container {
        background-color: #fff;
        display: inline-block;
        padding: 15px;
        border-radius: 8px;
    }
    
    /* 移动端优化 */
    @media (max-width: 576px) {
        .card-body {
            padding: 1rem;
        }
        .btn {
            width: 100%;
            margin-bottom: 0.5rem;
        }
        .qrcode-container {
            padding: 10px;
        }
    }
</style>
{% endblock %} 